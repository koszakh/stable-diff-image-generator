# Image Generation API

Этот проект представляет собой API для генерации изображений с использованием Stable Diffusion. Он разработан с использованием фреймворка Django для бэкенда и Celery для асинхронной обработки задач генерации. Все компоненты (Django, Celery, RabbitMQ, MySQL) развернуты в Docker-контейнерах.

## Необходимые условия

* **Docker:** Убедитесь, что у вас установлен Docker и Docker Compose. Вы можете скачать и установить их с [официального сайта Docker](https://www.docker.com/get-started).

## Запуск проекта

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/koszakh/stable-diff-image-generator
    cd stable-diff-image-generator
    ```

2.  **Скопируйте переменные среды из `.env.example`:**
     `cp .env.example .env`

3.  **Запустите Docker-контейнеры:**
    ```bash
    docker-compose up -d --build
    ```
    Эта команда соберет образы (если необходимо) и запустит контейнеры в фоновом режиме.

## Использование API

После запуска контейнеров Django API будет доступен по адресу `http://localhost:8000`.

### Эндпоинты (примеры)

* **Создание задачи генерации:** `POST /api/generate/` (пример тела запроса в формате JSON: `{"prompt": "A futuristic cityscape at sunset"}`)
    * Этот эндпоинт создаст новую запись в базе данных и отправит задачу в Celery для асинхронной генерации изображения.
    * В ответе вы получите ID созданной задачи.

* **Получение статуса задачи:** `GET /api/status/<task_id>/`
    * Используйте ID задачи, полученный при создании, чтобы узнать текущий статус генерации (например, "pending", "processing", "completed", "failed").
    * Для завершенных задач ответ может также содержать URL сгенерированного изображения.

* **Получение сгенерированного изображения:** `GET /media/<путь_к_изображению>`
    * После завершения задачи вы сможете получить сгенерированное изображение по URL, указанному в ответе на запрос статуса задачи.

**Примечание:** Реальные эндпоинты и их параметры зависят от вашей реализации в Django-приложении `image_api`.

## Настройка

* **Конфигурация Django:** Настройки Django находятся в файле `image_api/image_api/settings.py`. Вы можете изменить параметры базы данных, Celery и другие настройки здесь.
* **Конфигурация Celery:** Настройки Celery определены в `image_api/image_api/settings.py` и в файле `image_api/image_api/celery_app.py`. Брокер сообщений (RabbitMQ) настраивается в `docker-compose.yml`.
* **Docker Compose:** Файл `docker-compose.yml` определяет конфигурацию всех Docker-контейнеров (база данных, RabbitMQ, Django, Celery). Вы можете изменять порты, переменные окружения, зависимости и другие параметры здесь.
* **Dockerfile:** Файл `Dockerfile` используется для сборки Docker-образа для Django и Celery. Вы можете изменять базовый образ, устанавливаемые зависимости и другие настройки.

## Запуск Celery-воркера

Celery-воркер запускается автоматически как отдельный Docker-контейнер с помощью команды, определенной в `docker-compose.yml`:

```yaml
command: celery -A image_api.image_api.celery_app worker --loglevel=info